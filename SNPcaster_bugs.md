# SNPcater 2024.05 既知のバグ等（2024-07-26現在）
下記の不具合等が見つかっています。可能なものは修正予定ですが、差し当たっては下記の通り対処をお願いします。

<br>

### 1. grape_qc_assemblyで、ゲノムサイズをconfigurationファイルで指定しても反映されない。

【原因】<br>
configurationファイル内の「Genome size」欄に、小数点を含まない数字を入れると認識されず、デフォルト値（5.5）が適用されます。

【対処法】<br>
configurationファイル内の「Genome size」は、小数点を含めて入れてください。
例. ゲノムサイズが3 Mbの場合、「3」ではなく「3.0」と入力してください。

<br>

### 2. リストで指定したサンプル名（菌株名）の長さが異なる場合、誤ったfastqファイルが読み込まれる場合がある。
【原因】<br>
例えば、リストで「strain1」を指定した場合、「strain1\*R1*fastq.gz」（*は任意の文字列）をfastqファイルとして認識するため、誤って「strain11.R1.fastq.gz」や「strain101.R1.fastq.gz」のようなファイルを読み込む可能性がある。

【対処法】<br>
サンプル名は、全て同じ長さにしてください。例えば、「strain01」, 「strain12」など

<br>

## 3. checkMが動作しない
【原因】
* メモリが少ない端末向けのコマンド （--reduced_treeオプションを付けた方）でも、10 GB程度のメモリがないと動作しない。
* WinまたはMacでは端末のメモリの一部しかdockerに割り当てられない（例. 端末のメモリは64 GBでも使用されているのは、8 GB）ことが原因である可能性がある。

【対処法】<br>
以下のサイトを参考にメモリ割り当てを変更してください。

* Windows

下記サイトを参考に、WSL2のメモリ割り当てを変更

https://zenn.dev/karaage0703/articles/d38e17bd6efbaa


* Mac

下記サイトを参考に、Docker desktopでメモリ割り当てを変更

https://qiita.com/wsigma21/items/3c7305631db0cf629cc7

<br>

## 4. リファレンス配列の配列名にスペースが入っているとSNPcasterが動作しない

【原因】<br>
SNPcasterで用いるリファレンス配列の配列名（FASTAファイルの1行目）にスペースが含まれると、動作しません。

【対処法】<br>
配列名にはスペースを用いないでください。

* 【正】>Sakai_BA000007
* 【誤】>BA000007 Escherichia coli Sakai

<br>

## 5. grape_qc_assemblyにて、アセンブラーをSKESAに指定した際、qc_results.xlsxの内容に不備がある

「spades_summary」シートで、サンプル名が表示されない。そもそもspadesは使用していないので、シート名が不正確。なお、このシートの内容はQUASTの結果です。

【対処法】<br>
他のシートとサンプルの並びは同一なので、マニュアルでサンプル名を加えてください。

<br>

***

# その他注意点
## 1. SNP抽出条件
SNP抽出の際、偽陽性SNPの除去や組換え領域の除去を目的に、以下の領域を除くことが多いですが、標準的な方法があるわけではありません。


* リピート領域の除去

    偽陽性SNP除去の目的で行っていますが、組換えの多い菌種ではゲノム全体の数割が該当することがあります。
* クラスターSNPの除去

    SNP同士の距離が近い場合は組換えによるものとして除去することがあります。
* Gubbinsによる組換え領域の除去

大腸菌の集団感染調査では、いずれも大きな影響がないことを確認していますが、他菌種では未検証です。

数カ所のSNPが重要な場合には、複数条件（例えば、Gubbinsあり、なしの結果を比較する）を比べるのをお勧めします。
